// Atomic:
// Call state app to check state
// Send fees to fee account
// Send earned energy to B
// Send left over energy to A

// create unsigned transactions
goal app call --from=ESCROW_ADDR --app-id=APP_ID --out=state.txn --app-arg="str:UNLOCK"
goal clerk send --from=ESCROW_ADDR --to=FEE_ADDR --amount=FEE_AMOUNT --out=fee.txn
goal clerk send --from=ESCROW_ADDR --to=B_ADDR --amount=EARNED_AMOUNT --out=b.txn
goal clerk send --from=ESCROW_ADDR --to=A_ADDR --amount=LEFT_OVER_AMOUNT --out=a.txn

// combine transactions
cat state.txn fee.txn b.txn a.txn > combinedtransactions.txn

// group transactions
goal clerk group --infile combinedtransactions.txn --outfile groupedtransactions.txn

// sign
goal clerk sign --infile groupedtransactions.txn --outfile signout.txn

// send
goal clerk rawsend --filename signout.txn

/////////

// step 1: LOCK
goal app call --from=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I --app-id=23366213 --app-arg="str:LOCK" --app-arg="addr:RMKUQNJ7KGMRWANBQ3KNHEKWNI7EA7ESWV3DOB7XMTG7DMP3LPDCI4FUNI" --app-arg="int:3" --out=state.txn -w test
goal clerk send --from=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I --to=J2M2AE7PUA5XQIHEROV5BA4K5WQKQ7TFUCH6U5DFPCOMP6YZJMBBPZQQEQ --amount=100000 --out=lock.txn -w test
cat state.txn lock.txn > combinedtransactions.txn
goal clerk group --infile combinedtransactions.txn --outfile groupedtransactions.txn
goal clerk sign --infile groupedtransactions.txn --outfile signout.txn -w test
goal clerk rawsend --filename signout.txn

// step 2: UNLOCK
goal app call --from=YAVXHYBX7ILFZZ2PP5S5LAKU77R2NZOYBS2GBCNE3NMGS66Y44AOIA6BO4 --app-id=23366213 --app-account=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I --app-account=RMKUQNJ7KGMRWANBQ3KNHEKWNI7EA7ESWV3DOB7XMTG7DMP3LPDCI4FUNI --app-arg="str:UNLOCK" --out=state.txn -w test
goal clerk send --from-program escrow.teal --to=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I --amount=99820 --out=A.txn
goal clerk send --from-program escrow.teal --to=OU63ZTRQ52BLI4L2APIB42W4AVUSIA52CPOC662T5YKTGQ5XKCE5UMI5RE --amount=18 --out=fee.txn
goal clerk send --from-program escrow.teal --to=RMKUQNJ7KGMRWANBQ3KNHEKWNI7EA7ESWV3DOB7XMTG7DMP3LPDCI4FUNI --amount=162 --out=B.txn
cat state.txn A.txn fee.txn B.txn > combinedtransactions.txn
goal clerk group --infile combinedtransactions.txn --outfile groupedtransactions.txn
goal clerk split --infile groupedtransactions.txn --outfile splitfiles
goal clerk sign --infile splitfiles-0 --outfile splitfiles-0.sig -w test
cat splitfiles-0.sig splitfiles-1 splitfiles-2 splitfiles-3 > signout.txn
goal clerk rawsend --filename signout.txn

// to check
goal app read --app-id=23366213 --local --from=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I
goal clerk dryrun -t signout.txn
goal clerk dryrun -t signout.txn --dryrun-dump  -o dr.json
tealdbg debug state_approvalprogram.teal -d dr.msgp --group-index 0